{% load lampstands_tags cache staticfiles wagtailuserbar wagtailcore_tags wagtailimages_tags wagtailsettings_tags %}

<!DOCTYPE html>
<html>
<head></head>
<body>
<div class="map_wrapper">
    <div id="map" class="map_container">
    </div>
    <div class="map_results">
        <div class="map_detail">
        </div>
        <div class="map_listings">
            <div class="map_listings_headline">
                <h2>Results <span class="map_listings_number"></span></h2>
            </div>
            <div class="map_listings_results">

            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4MAVqADcBv3nSIqd8y7RZWF9kmcVB6XQ&libraries=places,geometry"></script>
<script src="{% static 'lampstands/css/packages/src/storeLocator.all.js' %}"></script>
<script src="{% static 'lampstands/css/packages/src/storeLocator.js' %}"></script>
<script>
    
    $(function() {
        $('.map_container').storeLocator({
            remote: "{% static 'lampstands/css/packages/src/stores.json' %}",
            categoriesOptions: {
                showFilter: true,
                template: '<h5 class="filter_minimize">Filter by Category</h5><a class="map-marker-filter-restaurant" data-cat="restaurant"><img src="pins/restaurant.png" alt=""> Restaurant</a>' +
                '<a class="map-marker-filter-hotel" data-cat="hotel"><img src="pins/hotel.png" alt=""> Hotel</a>' +
                '<a class="map-marker-filter-bar" data-cat="bar"><img src="pins/bar.png" alt=""> bar</a>' +
                '<a class="map-marker-filter-casino" data-cat="casino"><img src="pins/casino.png" alt=""> casino</a>' +
                '<a class="map-marker-filter-gas" data-cat="gas"><img src="pins/gas.png" alt=""> gas</a>' +
                '<a class="map-marker-filter-ambulance" data-cat="ambulance"><img src="pins/ambulance.png" alt=""> ambulance</a>' +
                '<a class="map-marker-filter-all" data-cat="all">show all</a>',
                icons: {
                    'ambulance': 'pins/ambulance.png',
                    'bar': 'pins/bar.png',
                    'casino': 'pins/casino.png',
                    'gas': 'pins/gas.png',
                    'hotel': 'pins/hotel.png',
                    'restaurant': 'pins/restaurant.png'
                }
            },
            detailsOptions: {
                panorama: {
                    showPanorama: true
                }
            },
            responsiveOptions: [
                {
                    breakpoint: 768,
                    settings: {
                        mapHeight: 400,
                        listHeight: 400
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        mapHeight: 'full',
                        listHeight: 400
                    }
                }
            ],
            geoLocationOptions: {
                position: google.maps.ControlPosition.TOP_LEFT
            },
            routeOptions: {
                show: true,
                closeHtml: '<span class="label label-danger">close</span>',
            },
            onUpdateList: function() {
                $('.stars').stars();
            },
            onUpdateDetail: function()
            {
                var current = 0,
                        items = $('.result_item_detail_info .slider_container div'),
                        itemsLength = items.length;

                items.hide();
                showItem();

                function showItem() {
                    var item = items.eq(current);
                    items.hide();
                    item.css('display', 'inline-block');
                }

                $(document).on('click', '.result_item_detail_info .slider_container .next',function () {
                    current += 1;
                    if (current > itemsLength - 1) {
                        current = 0;
                    }
                    showItem();
                });

                $(document).on('click', '.result_item_detail_info .slider_container .prev',function () {
                    console.log(itemsLength)
                    current -= 1;
                    if (current < 0) {
                        current = itemsLength - 1;
                    }
                    showItem();
                });


                if (window.timer) {
                    clearTimeout(timer);
                }
                timer = setTimeout(function () {
                    $('.result_item_detail .image').attr('src', 'http://www.w124-freunde.com/wcf/images/avatars/avatar-1868.gif');
                }, 3000);
            }
        });
    });
    /*
    http://stackoverflow.com/a/1987545
     */

    $.fn.stars = function() {
        return $(this).each(function() {
            $(this).html($('<span />').width(Math.max(0, (Math.min(5, Math.round(parseFloat($(this).html())) / 2))) * 16));
        });
    }

</script>

<script id="YOUR_LIST_TEMPLATE_ID" type="text/x-jQuery-tmpl">
    
</script>
<script id="YOUR_DETAIL_TEMPLATE_ID" type="text/x-jQuery-tmpl">
    
</script>
</body>
</html>