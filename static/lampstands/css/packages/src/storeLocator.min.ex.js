(function(e,t,n,r){"use strict";function o(t,n){this.element=t;this.settings=e.extend(true,s,n);this._name=i;this.markers=[];this._markers={};this.stores={};this._showData=[];this.itemCount;this._markerCluster=null;this._filterNavigationHeight=null;this._activeCategories=[];this.zoomListener=null;this.init()}var i="storeLocator",s={remote:null,height:null,defaultLocation:null,mapOptions:{zoom:9,minZoom:4,maxZoom:16,scrollwheel:true,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER},zoomControl:true,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},scaleControl:true,streetViewControl:false,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}]},templates:{list:"mapListEntryTemplate",detail:"mapListDetailTemplate"},markerOptions:{draggable:false,bounceMarker:true,markerIcon:BLA,dropAnimation:false},categoriesOptions:{categoryField:"category",showFilter:false,filterPosition:google.maps.ControlPosition.LEFT_TOP,template:null,boundOnClick:false,icons:null},detailsOptions:{closeTrigger:".map_details_close",panorama:{container:"pano",showPanorama:false,notFoundText:"Street View data not found for this location.",searchRadius:50}},searchOptions:{show:true,placeholder:"Enter your search term..."},listOptions:{position:"right",sortByDistance:false,distanceType:"km",updateOn:{drag:true,zoom:true,resize:true}},geoLocationOptions:{show:true,icon:BUL,title:"Show your Location",zoom:9,position:google.maps.ControlPosition.TOP_LEFT,index:1},autocompleteOptions:{show:true,position:google.maps.ControlPosition.TOP_LEFT,placeholder:"find location by city",country:null,types:"(cities)",zoom:9,"class":"map_btn_custom",index:2,errorNotFound:"No result for your search!"},markerCluster:{cluster:true,imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",cssClass:"custom-pin"},routeOptions:{show:false,headline:"<h3>Direction</h3>",trigger:"map_direction_trigger",closeTrigger:"map_direction_close_trigger",closeHtml:"close",types:"address",country:null},notificationOptions:{"class":"custom-class",duration:5e3},responsiveOptions:[{breakpoint:768,settings:{mapHeight:400,listHeight:400}},{breakpoint:480,settings:{mapHeight:"full",listHeight:400}}],onUpdateDetail:function(){},onUpdateList:function(){},onBeforeClickMarker:function(){}};e.extend(o.prototype,{init:function(){if(this.settings.listOptions.position=="right"){e(".map_container").css("float","left");e(".map_detail").addClass("from_right")}else if(this.settings.listOptions.position=="left"){e(".map_container").css("float","right");e(".map_detail").addClass("from_left")}this._initMap();if(this.settings.remote==null){this._showNotification("No remote url specified.");return}var t=this;e.ajax({url:this.settings.remote,async:false,dataType:"json",success:e.proxy(function(e){this.stores=e},this),complete:e.proxy(function(){this._initAfterDataLoaded()},this)})},_initAfterDataLoaded:function(){if(this.stores.length===0){alert("no data found")}this._initResponsive();var r=this;e(t).on("resize",function(){r._initResponsive()});this._initMarker();if(this.settings.defaultLocation==null){this._initList()}this._initClicks();if(this.settings.geoLocationOptions.show){if("https:"==n.location.protocol){e('<div class="map_geotarget"><div class="map_btn_custom" title="'+this.settings.geoLocationOptions.title+'"><img src="'+this.settings.geoLocationOptions.icon+'" alt="'+this.settings.geoLocationOptions.title+'" /></div></div>');var i=n.createElement("div");i.style.margin="10px";i.className="map_geotarget";var s=n.createElement("div");s.className="map_btn_custom";i.appendChild(s);var o=n.createElement("img");o.src=this.settings.geoLocationOptions.icon;o.alt=this.settings.geoLocationOptions.title;s.appendChild(o);i.index=this.settings.geoLocationOptions.index;this.map.controls[this.settings.geoLocationOptions.position].push(i)}else{this._showNotification("Only secure origins are allowed for GeoLocation. You need HTTPS.")}}if(this.settings.autocompleteOptions.show){var u=n.createElement("div");u.style.margin="10px";var a=n.createElement("input");a.setAttribute("type","text");a.setAttribute("class",this.settings.autocompleteOptions.class);a.setAttribute("id","pac-input");a.setAttribute("placeholder",this.settings.autocompleteOptions.placeholder);u.appendChild(a);u.index=this.settings.autocompleteOptions.index;this.map.controls[this.settings.autocompleteOptions.position].push(u);var f=a;var l={types:[this.settings.autocompleteOptions.types]};if(this.settings.autocompleteOptions.country!==null){if(this.settings.autocompleteOptions.country.toLowerCase()!="all"){l.componentRestrictions={country:this.settings.autocompleteOptions.country}}}var c=new google.maps.places.Autocomplete(f,l);google.maps.event.addListener(c,"place_changed",function(){if(!this.getPlace().geometry){r._showNotification(r.settings.autocompleteOptions.errorNotFound);return false}var e=new google.maps.LatLng(this.getPlace().geometry.location.lat(),this.getPlace().geometry.location.lng());r.map.setCenter(e);r.map.setZoom(r.settings.autocompleteOptions.zoom)})}if(this.settings.searchOptions.show){e("<div>",{"class":"map_filter_box"}).append(e("<div>",{"class":"map_filter_input"}).append(e('<input type="text">').attr("class","map_search_input").attr("placeholder",this.settings.searchOptions.placeholder).attr("name","search").attr("id","search")).append(e("<span>").attr("class","map_search_icon"))).appendTo(".map_listings_headline")}if(this.settings.categoriesOptions.showFilter){var h=n.createElement("div");h.style.margin="10px";h.className="categories";h.id="mapFilterNavigation";if(this.settings.categoriesOptions.template){h.innerHTML=this.settings.categoriesOptions.template}else{if(this.settings.categoriesOptions.icons!=null){e.each(this.settings.categoriesOptions.icons,function(e){var t=n.createElement("a");t.className="ucwords map-marker-filter-"+e;t.setAttribute("data-cat",e);t.innerHTML=e;h.appendChild(t)});var p=n.createElement("a");p.className="ucwords map-marker-filter-all";p.setAttribute("data-cat","all");p.innerHTML="show all";h.appendChild(p)}}h.index=this.settings.autocompleteOptions.index;this.map.controls[this.settings.categoriesOptions.filterPosition].push(h)}if(this.settings.routeOptions.show){e("<div>",{"class":"map_route",id:"map_route"}).append(this.settings.routeOptions.headline).append(e('<input type="text">').attr("class","map_direction_input").attr("placeholder",this.settings.routeOptions.placeholder).attr("name","origin").attr("id","map_direction_input")).append(e("<a>",{"class":"map_direction_close_trigger",html:this.settings.routeOptions.closeHtml})).appendTo(".map_results");this._directionsDisplay=new google.maps.DirectionsRenderer;var d=new google.maps.DirectionsService;var v=this._checkClassOrId(this.settings.routeOptions.trigger);e(n).on("click",v,function(t){if(!e(".map_route").hasClass("open")){e(".map_route").addClass("open");t.preventDefault();var i="";if(e(".map_direction_input").val().length>0){i=e(".map_direction_input").val()}var s=e(this).tmplItem();if(e.isEmptyObject(s.data)===false){var o=s.data.location.latitude+","+s.data.location.longitude;r._routeDestination=o;if(i.length>0){r._directionsDisplay.setMap(r.map);r._directionsDisplay.setPanel(n.getElementById("map_route"));r._calculateAndDisplayRoute(d,r._directionsDisplay,i,o)}}}});var m=this._checkClassOrId(this.settings.routeOptions.closeTrigger);e(n).on("click",m,e.proxy(r._closeDirections,r));var f=n.getElementById("map_direction_input");var l={types:[this.settings.routeOptions.types],componentRestrictions:{country:this.settings.routeOptions.country}};if(this.settings.routeOptions.country!=null){var l={types:[this.settings.routeOptions.types],componentRestrictions:{country:this.settings.routeOptions.country}}}else{var l={types:[this.settings.routeOptions.types]}}var c=new google.maps.places.Autocomplete(f,l);google.maps.event.addListener(c,"place_changed",function(){if(!this.getPlace()){return}var e=new google.maps.LatLng(this.getPlace().geometry.location.lat(),this.getPlace().geometry.location.lng());var t=e;if(r._routeDestination){r._directionsDisplay.setMap(r.map);r._directionsDisplay.setPanel(n.getElementById("map_route"));var i=r._routeDestination;r._calculateAndDisplayRoute(d,r._directionsDisplay,t,i)}})}e(n).on("mouseenter",".result_item",function(){var t=e(this).data("id");r._markers[t].setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){r._markers[t].setAnimation(null)},750)});e(n).on("mouseleave",".result_item",function(){var t=e(this).data("id");r._markers[t].setAnimation(null)});google.maps.event.addListenerOnce(this.map,"tilesloaded",e.proxy(function(){if(this.settings.listOptions.updateOn.zoom){r.zoomListener=google.maps.event.addListener(this.map,"zoom_changed",e.proxy(this._getInViewportMarkers,this))}if(this.settings.listOptions.updateOn.drag){google.maps.event.addListener(this.map,"dragend",e.proxy(this._getInViewportMarkers,this))}if(this.settings.listOptions.updateOn.resize){google.maps.event.addListener(this.map,"resize",e.proxy(this._getInViewportMarkers,this));google.maps.event.addDomListener(t,"resize",e.proxy(function(){if(this.settings.defaultLocation==null){this.map.fitBounds(this._bounds)}},this))}},this))},_initMap:function(){this.map=new google.maps.Map(e(this.element)[0],this.settings.mapOptions)},_initMarker:function(){this._createMarkers();if(this.settings.defaultLocation!=null){this._initDefaultLocation()}else{if(this.settings.listOptions.sortByDistance){this.map.setCenter(this._bounds.getCenter())}this.map.fitBounds(this._bounds)}},_initDefaultLocation:function(){var e=this.settings.defaultLocation,t;if(e instanceof Array){t=new google.maps.LatLng(e[0],e[1])}if(this.map){this.map.setCenter(t)}this.map.setZoom(this.settings.mapOptions.zoom);var n=this;this._boundInitListener=google.maps.event.addListener(n.map,"bounds_changed",function(){n._getInViewportMarkers()})},_initClicks:function(){var t=this;e(n).on("click",".result_item a",function(n){n.preventDefault();var r=e(this).tmplItem();if(e.isEmptyObject(r.data)===false){t._updateDetail(r.data)}});e(n).on("click",".filter_minimize",function(){var n=e("#mapFilterNavigation");if(t._filterNavigationHeight==null){t._filterNavigationHeight=n.innerHeight()}n.height(t._filterNavigationHeight);if(n.hasClass("minimized")){n.removeClass("minimized")}else{var r=e(this).outerHeight(true);n.height(r);n.addClass("minimized")}});e(n).on("click",".map_geotarget",function(){var n=t;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e.proxy(t._geolocationSuccess,t),t._geolocationError)}else{n._showNotification("geolocation not supported.")}});e(n).on("click",".map_search_icon",function(){var t=e(".map_filter_input");if(t.hasClass("input_open")){t.removeClass("input_open")}else{t.addClass("input_open")}});e(n).on("keyup","#search",function(){var t=e(this).val(),n=0;e(".result_item").each(function(){if(e(this).text().search(new RegExp(t,"i"))<0){e(this).fadeOut()}else{e(this).show();n++}})});e(n).on("click",".categories a",function(n){n.preventDefault();if(e(this).hasClass("map-marker-filter-all")){e(".categories a").not(this).removeClass("active");e(this).addClass("active");t._activeCategories=[]}else{var r=e(this).data("cat");if(e(this).hasClass("active")){t._activeCategories=e.grep(t._activeCategories,function(e){return e!=r});e(this).removeClass("active")}else{e(this).addClass("active");t._activeCategories.push(r)}}t._createMarkers();if(t.settings.categoriesOptions.boundOnClick){if(t.settings.listOptions.updateOn.zoom){if(t.zoomListener){google.maps.event.removeListener(t.zoomListener)}}t.map.fitBounds(t._bounds);t._initList();if(t.settings.listOptions.updateOn.zoom){t.zoomListener=google.maps.event.addListener(t.map,"zoom_changed",e.proxy(t._getInViewportMarkers,t))}}else{t._getInViewportMarkers()}});e(n).on("click",this.settings.detailsOptions.closeTrigger,function(e){e.preventDefault();t.closeDetail()})},_geolocationSuccess:function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);this.map.setCenter(t);this.map.setZoom(this.settings.geoLocationOptions.zoom)},_geolocationError:function(e){this._showNotification(e)},_checkClassOrId:function(e){var t=e;if(n.getElementsByClassName(e).length!=0){t="."+e}else if(n.getElementById(e)!=null){t="#"+e}else{t="."+e}return t},_createMarkers:function(){this._removeMarkers();var t=new google.maps.LatLngBounds;var n=0;this.markers=[];this._showData=[];var i=this._activeCategories;for(var s=0;s<this.stores.length;s++){var o=this.stores[s];var u=this.settings.categoriesOptions.categoryField;var a;var f=o[u];if(e.isEmptyObject(i)===false){if(e.inArray(f,i)===-1){continue}}this._showData.push(o);if(this.settings.categoriesOptions.icons!=null&&this.settings.categoriesOptions.icons[f]){a=this.settings.categoriesOptions.icons[f]}else{a=this.settings.markerOptions.markerIcon}var l=new google.maps.LatLng(o.location.latitude,o.location.longitude);var c=new google.maps.Marker({position:l,map:this.map,icon:a,draggable:this.settings.markerOptions.draggable,itemId:o.id});if(this.settings.markerOptions.dropAnimation){c.setAnimation(google.maps.Animation.DROP)}this._markers[o.id]=c;this.markers.push(c);var h=this;google.maps.event.addListener(c,"click",this._handleMarkerClick.bind(r,c,o,this));google.maps.event.addListener(c,"mouseover",this._handleMarkerMouseover.bind(r,c,o,this));google.maps.event.addListener(c,"mouseout",function(){e(".map_listings_results .result_item").removeClass("active")});t.extend(l);++n}this._bounds=t;this.itemCount=n;if(this.settings.markerCluster.cluster){this._markerCluster=new MarkerClusterer(this.map,this.markers,{imagePath:this.settings.markerCluster.imagePath,cssClass:this.settings.markerCluster.cssClass})}},_handleMarkerClick:function(t,n,r){var i=r.settings.onBeforeClickMarker;if(e.isFunction(i)){i.call(this,n)}r._updateDetail(n);if(r.settings.routeOptions.show){r._closeDirections()}},_handleMarkerMouseover:function(t,n,r){var i=e('*[data-id="'+n.id+'"]');i.addClass("active")},_getInViewportMarkers:function(){this.viewPortMarkers=[];for(var e=0;e<this.markers.length;e++){if(this.map.getBounds().contains(this.markers[e].position)){this.viewPortMarkers[e]=this.markers[e].itemId}}google.maps.event.removeListener(this._boundInitListener);this._updateList()},_removeMarkers:function(){for(var e=0;e<this.markers.length;e++){this.markers[e].setMap(null)}if(this.settings.markerCluster.cluster){if(this._markerCluster){this._markerCluster.clearMarkers()}}},_initList:function(){if(this.settings.listOptions.sortByDistance){var t=new google.maps.LatLng(this.map.getCenter().lat(),this.map.getCenter().lng());for(var n=0;n<this._showData.length;n++){var r=new google.maps.LatLng(this._showData[n].location.latitude,this._showData[n].location.longitude);var i=google.maps.geometry.spherical.computeDistanceBetween(t,r);if(this.settings.listOptions.distanceType=="miles"){i=i*.000621371192}else{i=i/1e3}this._showData[n].distance=i.toFixed(1)}this._showData.sort(this._sortByDistance)}e(".map_listings_results").html("");e("#"+this.settings.templates.list).tmpl(this._showData).appendTo(".map_listings_results");this._updateCount();var s=this.settings.onUpdateList;if(e.isFunction(s)){s.call(this)}},_updateList:function(){var t=this._showData;var n=[];if(this.settings.listOptions.sortByDistance){var r=new google.maps.LatLng(this.map.getCenter().lat(),this.map.getCenter().lng())}for(var i=0;i<this.viewPortMarkers.length;i++){for(var s=0;s<t.length;s++){if(this.viewPortMarkers[i]==t[s].id){if(this.settings.listOptions.sortByDistance){var o=new google.maps.LatLng(t[s].location.latitude,t[s].location.longitude);var u=google.maps.geometry.spherical.computeDistanceBetween(r,o);if(this.settings.listOptions.distanceType=="miles"){u=u*.000621371192}else{u=u/1e3}t[s].distance=u.toFixed(1)}n.push(t[s])}}}if(this.settings.listOptions.sortByDistance){n.sort(this._sortByDistance)}this.itemCount=n.length;this._updateCount();e(".map_listings_results").html("");e("#"+this.settings.templates.list).tmpl(n).appendTo(".map_listings_results");var a=this.settings.onUpdateList;if(e.isFunction(a)){a.call(this,t)}},_sortByDistance:function(e,t){return e.distance-t.distance},_updateDetail:function(t){e(".map_detail").html("");e("#"+this.settings.templates.detail).tmpl(t).appendTo(".map_detail");e(".map_results").addClass("detail_open");if(this.settings.detailsOptions.panorama.showPanorama){var r=new google.maps.StreetViewService;var i=new google.maps.LatLng(t.location.latitude,t.location.longitude);var s=this.settings.detailsOptions.panorama;r.getPanorama({location:i,radius:this.settings.detailsOptions.panorama.searchRadius},function(t,r){if(r===google.maps.StreetViewStatus.OK){var i=new google.maps.StreetViewPanorama(n.getElementById(s.container));i.setPano(t.location.pano);i.setPov({heading:270,pitch:0});i.setVisible(true)}else{e("#"+s.container).css({"background-color":"transparent",height:"auto",width:"100%"});e("#"+s.container).html(s.notFoundText)}})}var o=this.settings.onUpdateDetail;if(e.isFunction(o)){o.call(this,t)}},_updateCount:function(){e(".map_listings_headline .map_listings_number").html("("+this.itemCount+")")},closeDetail:function(){e(".map_results").removeClass("detail_open");setTimeout(function(){e(".map_detail").html("")},700)},_calculateAndDisplayRoute:function(e,t,n,r){var i=this;e.route({origin:n,destination:r,travelMode:google.maps.TravelMode.DRIVING},function(e,n){if(n===google.maps.DirectionsStatus.OK){t.setDirections(e)}else{i._showNotification("Directions request failed due to "+n)}})},_closeDirections:function(){if(e(".map_route").hasClass("open")){e(".map_route").removeClass("open");this._directionsDisplay.setMap(null)}},_showNotification:function(t){e("<div>",{id:"map_notification","class":this.settings.notificationOptions.class}).append(t).appendTo(".map_container").fadeIn("slow");setTimeout(function(){e("#map_notification").fadeOut("slow",function(){e("#map_notification").remove()})},this.settings.notificationOptions.duration)},_initResponsive:function(){var r=Math.max(n.documentElement.clientWidth,t.innerWidth||0);var i=Math.max(n.documentElement.clientHeight,t.innerHeight||0);var s=this,o,u;var a=t.innerWidth||e(t).width();for(var f=0,l=s.settings.responsiveOptions.length;f<l;f++){if(a<=s.settings.responsiveOptions[f].breakpoint){o=s.settings.responsiveOptions[f].breakpoint}}e(s.settings.responsiveOptions).each(function(e,t){if(o==t.breakpoint){u=t.settings}});var c=i;var h;var p=e(".map_wrapper");if(typeof u==="undefined"){if(this.settings.height!=null&&this.settings.height.length>0){p.height(this.settings.height)}else{p.css("height",i)}e(".map_container").css("height","100%");e(".map_results").css("height","100%")}else{p.css("height","auto");if(u.mapHeight==="full"){c=i}else{c=u.mapHeight}h=u.listHeight;e(".map_container").css("height",c);e(".map_results").css("height",h)}if(this.settings.categoriesOptions.showFilter){setTimeout(function(){var t=e("#mapFilterNavigation");if(t.length>0){var n=e(".map_container").height();var r=e(t).outerHeight(true);var i=e(t).position().top;if(n-(r+i)<0){e(t).css("height",n-(i+50));e(t).css("overflow","auto")}else{e(t).css("overflow","hidden");e(t).css("height","auto")}}},1e3)}}});e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)