!function(a,b,c,d){"use strict";function g(b,c){this.element=b,this.settings=a.extend(!0,f,c),this._name=e,this.markers=[],this._markers={},this.stores={},this._showData=[],this.itemCount,this._markerCluster=null,this._filterNavigationHeight=null,this._activeCategories=[],this.infowindow=null,this.zoomListener=null,this.init()}var e="storeLocator",f={remote:null,height:null,defaultLocation:null,mapOptions:{zoom:9,minZoom:4,maxZoom:16,scrollwheel:!0,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},scaleControl:!0,streetViewControl:!1,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}]},templates:{list:"mapListEntryTemplate",detail:"mapListDetailTemplate"},markerOptions:{draggable:!1,bounceMarker:!0,markerIcon:BLA,dropAnimation:!1},categoriesOptions:{categoryField:"category",showFilter:!1,filterPosition:google.maps.ControlPosition.LEFT_TOP,template:null,boundOnClick:!1,icons:null},detailsOptions:{closeTrigger:".map_details_close",panorama:{container:"pano",showPanorama:!1,notFoundText:"Street View data not found for this location.",searchRadius:50}},searchOptions:{show:!0,placeholder:"Enter your search term..."},listOptions:{position:"right",sortByDistance:!1,distanceType:"km",updateOn:{drag:!0,zoom:!0,resize:!0}},geoLocationOptions:{show:!0,icon:BUL,title:"Show your Location",zoom:9,position:google.maps.ControlPosition.TOP_LEFT,index:1},autocompleteOptions:{show:!0,position:google.maps.ControlPosition.TOP_LEFT,placeholder:"find location by city",country:"all",types:"(cities)",zoom:9,class:"map_btn_custom",index:2,errorNotFound:"No result for your search!"},markerCluster:{cluster:!0,imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",cssClass:"custom-pin"},routeOptions:{show:!1,headline:"<h3>Direction</h3>",trigger:"map_direction_trigger",closeTrigger:"map_direction_close_trigger",closeHtml:"close",types:"address",country:null},notificationOptions:{class:"custom-class",duration:5e3},responsiveOptions:[{breakpoint:768,settings:{mapHeight:400,listHeight:400}},{breakpoint:480,settings:{mapHeight:"full",listHeight:400}}],onUpdateDetail:function(){},onUpdateList:function(){},onBeforeClickMarker:function(){}};a.extend(g.prototype,{init:function(){if("right"==this.settings.listOptions.position?(a(".map_container").css("float","left"),a(".map_detail").addClass("from_right")):"left"==this.settings.listOptions.position&&(a(".map_container").css("float","right"),a(".map_detail").addClass("from_left")),this._initMap(),null==this.settings.remote)return void this._showNotification("No remote url specified.");a.ajax({url:this.settings.remote,async:!1,dataType:"json",success:a.proxy(function(a){this.stores=a},this),complete:a.proxy(function(){this._initAfterDataLoaded()},this)})},_initAfterDataLoaded:function(){0===this.stores.length&&alert("no data found"),this._initResponsive();var d=this;if(a(b).on("resize",function(){d._initResponsive()}),this._initMarker(),null==this.settings.defaultLocation&&this._initList(),this._initClicks(),this.settings.geoLocationOptions.show)if("https:"==c.location.protocol){a('<div class="map_geotarget"><div class="map_btn_custom" title="'+this.settings.geoLocationOptions.title+'"><img src="'+this.settings.geoLocationOptions.icon+'" alt="'+this.settings.geoLocationOptions.title+'" /></div></div>');var e=c.createElement("div");e.style.margin="10px",e.className="map_geotarget";var f=c.createElement("div");f.className="map_btn_custom",e.appendChild(f);var g=c.createElement("img");g.src=this.settings.geoLocationOptions.icon,g.alt=this.settings.geoLocationOptions.title,f.appendChild(g),e.index=this.settings.geoLocationOptions.index,this.map.controls[this.settings.geoLocationOptions.position].push(e)}else this._showNotification("Only secure origins are allowed for GeoLocation. You need HTTPS.");if(this.settings.autocompleteOptions.show){var h=c.createElement("div");h.style.margin="8px";var i=c.createElement("input");i.setAttribute("type","text"),i.setAttribute("class",this.settings.autocompleteOptions.class),i.setAttribute("id","pac-input"),i.setAttribute("placeholder",this.settings.autocompleteOptions.placeholder),h.appendChild(i),h.index=this.settings.autocompleteOptions.index,this.map.controls[this.settings.autocompleteOptions.position].push(h);var j=i,k={types:[this.settings.autocompleteOptions.types]};null!==this.settings.autocompleteOptions.country&&"all"!=this.settings.autocompleteOptions.country.toLowerCase()&&(k.componentRestrictions={country:this.settings.autocompleteOptions.country});var l=new google.maps.places.Autocomplete(j,k);google.maps.event.addListener(l,"place_changed",function(){if(!this.getPlace().geometry)return d._showNotification(d.settings.autocompleteOptions.errorNotFound),!1;var a=new google.maps.LatLng(this.getPlace().geometry.location.lat(),this.getPlace().geometry.location.lng());d.map.setCenter(a),d.map.setZoom(d.settings.autocompleteOptions.zoom)})}if(this.settings.searchOptions.show&&a("<div>",{class:"map_filter_box"}).append(a("<div>",{class:"map_filter_input"}).append(a('<input type="text">').attr("class","map_search_input").attr("placeholder",this.settings.searchOptions.placeholder).attr("name","search").attr("id","search")).append(a("<span>").attr("class","map_search_icon"))).appendTo(".map_listings_headline"),this.settings.categoriesOptions.showFilter){var m=c.createElement("div");if(m.style.margin="10px",m.className="categories",m.id="mapFilterNavigation",this.settings.categoriesOptions.template)m.innerHTML=this.settings.categoriesOptions.template;else if(null!=this.settings.categoriesOptions.icons){a.each(this.settings.categoriesOptions.icons,function(a){var b=c.createElement("a");b.className="ucwords map-marker-filter-"+a,b.setAttribute("data-cat",a),b.innerHTML=a,m.appendChild(b)});var n=c.createElement("a");n.className="ucwords map-marker-filter-all",n.setAttribute("data-cat","all"),n.innerHTML="show all",m.appendChild(n)}m.index=this.settings.autocompleteOptions.index,this.map.controls[this.settings.categoriesOptions.filterPosition].push(m)}if(this.settings.routeOptions.show){a("<div>",{class:"map_route",id:"map_route"}).append(this.settings.routeOptions.headline).append(a('<input type="text">').attr("class","map_direction_input").attr("placeholder",this.settings.routeOptions.placeholder).attr("name","origin").attr("id","map_direction_input")).append(a("<a>",{class:"map_direction_close_trigger",html:this.settings.routeOptions.closeHtml})).appendTo(".map_results"),this._directionsDisplay=new google.maps.DirectionsRenderer;var o=new google.maps.DirectionsService,p=this._checkClassOrId(this.settings.routeOptions.trigger);a(c).on("click",p,function(b){if(!a(".map_route").hasClass("open")){a(".map_route").addClass("open"),b.preventDefault();var e="";a(".map_direction_input").val().length>0&&(e=a(".map_direction_input").val());var f=a(this).tmplItem();if(!1===a.isEmptyObject(f.data)){var g=f.data.location.latitude+","+f.data.location.longitude;d._routeDestination=g,e.length>0&&(d._directionsDisplay.setMap(d.map),d._directionsDisplay.setPanel(c.getElementById("map_route")),d._calculateAndDisplayRoute(o,d._directionsDisplay,e,g))}}});var q=this._checkClassOrId(this.settings.routeOptions.closeTrigger);a(c).on("click",q,a.proxy(d._closeDirections,d));var j=c.getElementById("map_direction_input"),k={types:[this.settings.routeOptions.types],componentRestrictions:{country:this.settings.routeOptions.country}};if(null!=this.settings.routeOptions.country)var k={types:[this.settings.routeOptions.types],componentRestrictions:{country:this.settings.routeOptions.country}};else var k={types:[this.settings.routeOptions.types]};var l=new google.maps.places.Autocomplete(j,k);google.maps.event.addListener(l,"place_changed",function(){if(this.getPlace()){var a=new google.maps.LatLng(this.getPlace().geometry.location.lat(),this.getPlace().geometry.location.lng()),b=a;if(d._routeDestination){d._directionsDisplay.setMap(d.map),d._directionsDisplay.setPanel(c.getElementById("map_route"));var e=d._routeDestination;d._calculateAndDisplayRoute(o,d._directionsDisplay,b,e)}}})}a(c).on("mouseenter",".result_item",function(){var b=a(this).data("id");d._markers[b].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d._markers[b].setAnimation(null)},750)}),a(c).on("mouseleave",".result_item",function(){var b=a(this).data("id");d._markers[b].setAnimation(null)}),google.maps.event.addListenerOnce(this.map,"tilesloaded",a.proxy(function(){this.settings.listOptions.updateOn.zoom&&(d.zoomListener=google.maps.event.addListener(this.map,"zoom_changed",a.proxy(this._getInViewportMarkers,this))),this.settings.listOptions.updateOn.drag&&google.maps.event.addListener(this.map,"dragend",a.proxy(this._getInViewportMarkers,this)),this.settings.listOptions.updateOn.resize&&(google.maps.event.addListener(this.map,"resize",a.proxy(this._getInViewportMarkers,this)),google.maps.event.addDomListener(b,"resize",a.proxy(function(){null==this.settings.defaultLocation&&this.map.fitBounds(this._bounds)},this)))},this))},_initMap:function(){this.map=new google.maps.Map(a(this.element)[0],this.settings.mapOptions)},_initMarker:function(){this._createMarkers(),null!=this.settings.defaultLocation?this._initDefaultLocation():(this.settings.listOptions.sortByDistance&&this.map.setCenter(this._bounds.getCenter()),this.map.fitBounds(this._bounds))},_initDefaultLocation:function(){var b,a=this.settings.defaultLocation;a instanceof Array&&(b=new google.maps.LatLng(a[0],a[1])),this.map.setCenter(b),this.map.setZoom(this.settings.mapOptions.zoom);var c=this;this._boundInitListener=google.maps.event.addListener(c.map,"bounds_changed",function(){c._getInViewportMarkers()})},_initClicks:function(){var b=this;a(c).on("click",".result_item a",function(c){c.preventDefault();var d=a(this).tmplItem();!1===a.isEmptyObject(d.data)&&b._updateDetail(d.data)}),a(c).on("click",".filter_minimize",function(){var c=a("#mapFilterNavigation");if(null==b._filterNavigationHeight&&(b._filterNavigationHeight=c.innerHeight()),c.height(b._filterNavigationHeight),c.hasClass("minimized"))c.removeClass("minimized");else{var d=a(this).outerHeight(!0);c.height(d),c.addClass("minimized")}}),a(c).on("click",".map_geotarget",function(){var c=b;navigator.geolocation?navigator.geolocation.getCurrentPosition(a.proxy(b._geolocationSuccess,b),b._geolocationError):c._showNotification("geolocation not supported.")}),a(c).on("click",".map_search_icon",function(){var b=a(".map_filter_input");b.hasClass("input_open")?b.removeClass("input_open"):b.addClass("input_open")}),a(c).on("keyup","#search",function(){var b=a(this).val(),c=0;a(".result_item").each(function(){a(this).text().search(new RegExp(b,"i"))<0?a(this).fadeOut():(a(this).show(),c++)})}),a(c).on("click",".categories a",function(c){if(c.preventDefault(),a(this).hasClass("map-marker-filter-all"))a(".categories a").not(this).removeClass("active"),a(this).addClass("active"),b._activeCategories=[];else{var d=a(this).data("cat");a(this).hasClass("active")?(b._activeCategories=a.grep(b._activeCategories,function(a){return a!=d}),a(this).removeClass("active")):(a(this).addClass("active"),b._activeCategories.push(d))}b._createMarkers(),b.settings.categoriesOptions.boundOnClick?(b.settings.listOptions.updateOn.zoom&&b.zoomListener&&google.maps.event.removeListener(b.zoomListener),b.map.fitBounds(b._bounds),b._initList(),b.settings.listOptions.updateOn.zoom&&(b.zoomListener=google.maps.event.addListener(b.map,"zoom_changed",a.proxy(b._getInViewportMarkers,b)))):b._getInViewportMarkers()}),a(c).on("click",this.settings.detailsOptions.closeTrigger,function(a){a.preventDefault(),b.closeDetail()})},_geolocationSuccess:function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);this.map.setCenter(b),this.map.setZoom(this.settings.geoLocationOptions.zoom)},_geolocationError:function(a){this._showNotification(a)},_checkClassOrId:function(a){return 0!=c.getElementsByClassName(a).length?"."+a:null!=c.getElementById(a)?"#"+a:"."+a},_createMarkers:function(){this._removeMarkers();var b=new google.maps.LatLngBounds,c=0;this.markers=[],this._showData=[];for(var e=this._activeCategories,f=0;f<this.stores.length;f++){var i,g=this.stores[f],h=this.settings.categoriesOptions.categoryField,j=g[h];if(!1!==a.isEmptyObject(e)||-1!==a.inArray(j,e)){this._showData.push(g),i=null!=this.settings.categoriesOptions.icons&&this.settings.categoriesOptions.icons[j]?this.settings.categoriesOptions.icons[j]:this.settings.markerOptions.markerIcon;var k=new google.maps.LatLng(g.location.latitude,g.location.longitude),l=new google.maps.Marker({position:k,map:this.map,icon:i,draggable:this.settings.markerOptions.draggable,itemId:g.id});this.infowindow=new google.maps.InfoWindow;var m=this.map,n="<b><h6>Church in "+g.locality_name+"</h6></b>"+g.meeting_address+"<br><a href=http://safe-cove-64619.herokuapp.com"+g.url+">More info</a>",o=this;google.maps.event.addListener(l,"click",function(a,b){return function(){o.infowindow&&o.infowindow.close(),o.infowindow.setContent(b),o.infowindow.open(m,a)}}(l,n)),this.settings.markerOptions.dropAnimation&&l.setAnimation(google.maps.Animation.DROP),this._markers[g.id]=l,this.markers.push(l);var o=this;google.maps.event.addListener(l,"click",this._handleMarkerClick.bind(d,l,g,this)),google.maps.event.addListener(l,"mouseover",this._handleMarkerMouseover.bind(d,l,g,this)),google.maps.event.addListener(l,"mouseout",function(){a(".map_listings_results .result_item").removeClass("active")}),b.extend(k),++c}}this._bounds=b,this.itemCount=c,this.settings.markerCluster.cluster&&(this._markerCluster=new MarkerClusterer(this.map,this.markers,{imagePath:this.settings.markerCluster.imagePath,cssClass:this.settings.markerCluster.cssClass}))},_handleMarkerClick:function(b,c,d){var e=d.settings.onBeforeClickMarker;a.isFunction(e)&&e.call(this,c),d._updateDetail(c),d.settings.routeOptions.show&&d._closeDirections()},_handleMarkerMouseover:function(b,c,d){a('*[data-id="'+c.id+'"]').addClass("active")},_getInViewportMarkers:function(){this.viewPortMarkers=[];for(var a=0;a<this.markers.length;a++)this.map.getBounds().contains(this.markers[a].position)&&(this.viewPortMarkers[a]=this.markers[a].itemId);google.maps.event.removeListener(this._boundInitListener),this._updateList()},_removeMarkers:function(){for(var a=0;a<this.markers.length;a++)this.markers[a].setMap(null);this.settings.markerCluster.cluster&&this._markerCluster&&this._markerCluster.clearMarkers()},_initList:function(){if(this.settings.listOptions.sortByDistance){for(var b=new google.maps.LatLng(this.map.getCenter().lat(),this.map.getCenter().lng()),c=0;c<this._showData.length;c++){var d=new google.maps.LatLng(this._showData[c].location.latitude,this._showData[c].location.longitude),e=google.maps.geometry.spherical.computeDistanceBetween(b,d);"miles"==this.settings.listOptions.distanceType?e*=.000621371192:e/=1e3,this._showData[c].distance=e.toFixed(1)}this._showData.sort(this._sortByDistance)}a(".map_listings_results").html(""),a("#"+this.settings.templates.list).tmpl(this._showData).appendTo(".map_listings_results"),this._updateCount();var f=this.settings.onUpdateList;a.isFunction(f)&&f.call(this)},_updateList:function(){var b=this._showData,c=[];if(this.settings.listOptions.sortByDistance)var d=new google.maps.LatLng(this.map.getCenter().lat(),this.map.getCenter().lng());for(var e=0;e<this.viewPortMarkers.length;e++)for(var f=0;f<b.length;f++)if(this.viewPortMarkers[e]==b[f].id){if(this.settings.listOptions.sortByDistance){var g=new google.maps.LatLng(b[f].location.latitude,b[f].location.longitude),h=google.maps.geometry.spherical.computeDistanceBetween(d,g);"miles"==this.settings.listOptions.distanceType?h*=.000621371192:h/=1e3,b[f].distance=h.toFixed(1)}c.push(b[f])}this.settings.listOptions.sortByDistance&&c.sort(this._sortByDistance),this.itemCount=c.length,this._updateCount(),a(".map_listings_results").html(""),a("#"+this.settings.templates.list).tmpl(c).appendTo(".map_listings_results");var i=this.settings.onUpdateList;a.isFunction(i)&&i.call(this,b)},_sortByDistance:function(a,b){return a.distance-b.distance},_updateDetail:function(b){if(a(".map_detail").html(""),a("#"+this.settings.templates.detail).tmpl(b).appendTo(".map_detail"),a(".map_results").addClass("detail_open"),this.settings.detailsOptions.panorama.showPanorama){var d=new google.maps.StreetViewService,e=new google.maps.LatLng(b.location.latitude,b.location.longitude),f=this.settings.detailsOptions.panorama;d.getPanorama({location:e,radius:this.settings.detailsOptions.panorama.searchRadius},function(b,d){if(d===google.maps.StreetViewStatus.OK){var e=new google.maps.StreetViewPanorama(c.getElementById(f.container));e.setPano(b.location.pano),e.setPov({heading:270,pitch:0}),e.setVisible(!0)}else a("#"+f.container).css({"background-color":"transparent",height:"auto",width:"100%"}),a("#"+f.container).html(f.notFoundText)})}var g=this.settings.onUpdateDetail;a.isFunction(g)&&g.call(this,b)},_updateCount:function(){a(".map_listings_headline .map_listings_number").html("("+this.itemCount+")")},closeDetail:function(){a(".map_results").removeClass("detail_open"),setTimeout(function(){a(".map_detail").html("")},700)},_calculateAndDisplayRoute:function(a,b,c,d){var e=this;a.route({origin:c,destination:d,travelMode:google.maps.TravelMode.DRIVING},function(a,c){c===google.maps.DirectionsStatus.OK?b.setDirections(a):e._showNotification("Directions request failed due to "+c)})},_closeDirections:function(){a(".map_route").hasClass("open")&&(a(".map_route").removeClass("open"),this._directionsDisplay.setMap(null))},_showNotification:function(b){a("<div>",{id:"map_notification",class:this.settings.notificationOptions.class}).append(b).appendTo(".map_container").fadeIn("slow"),setTimeout(function(){a("#map_notification").fadeOut("slow",function(){a("#map_notification").remove()})},this.settings.notificationOptions.duration)},_initResponsive:function(){for(var g,h,e=(Math.max(c.documentElement.clientWidth,b.innerWidth||0),Math.max(c.documentElement.clientHeight,b.innerHeight||0)),f=this,i=b.innerWidth||a(b).width(),j=0,k=f.settings.responsiveOptions.length;j<k;j++)i<=f.settings.responsiveOptions[j].breakpoint&&(g=f.settings.responsiveOptions[j].breakpoint);a(f.settings.responsiveOptions).each(function(a,b){g==b.breakpoint&&(h=b.settings)});var m,l=e,n=a(".map_wrapper");void 0===h?(null!=this.settings.height&&this.settings.height.length>0?n.height(this.settings.height):n.css("height",e),a(".map_container").css("height","100%"),a(".map_results").css("height","100%")):(n.css("height","auto"),l="full"===h.mapHeight?e:h.mapHeight,m=h.listHeight,a(".map_container").css("height",l),a(".map_results").css("height",m)),this.settings.categoriesOptions.showFilter&&setTimeout(function(){var b=a("#mapFilterNavigation");if(b.length>0){var c=a(".map_container").height(),d=a(b).outerHeight(!0),e=a(b).position().top;c-(d+e)<0?(a(b).css("height",c-(e+50)),a(b).css("overflow","auto")):(a(b).css("overflow","hidden"),a(b).css("height","auto"))}},1e3)}}),a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b))})}}(jQuery,window,document);